<!DOCTYPE html>
<html>
<head>
  <title>Razorpay Test</title>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>
  <button id="pay">Pay Test Bill</button>

  <script>
    // âš ï¸ ALWAYS use a NEW order_id from /payments/initiate
    const orderId = "order_SAqbpszBhRLmpa";

    const options = {
      key: "rzp_test_SAnYmZGK1nkaa5",
      name: "SUVIDHA",
      description: "Bill Payment",
      order_id: orderId,

      handler: async function (response) {
        console.log("RAZORPAY SUCCESS:", response);

        const res = await fetch("http://localhost:5000/api/v1/payments/verify", {
          method: "POST",
          credentials: "include", // ðŸ”¥ REQUIRED FOR COOKIE AUTH
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            razorpay_order_id: response.razorpay_order_id,
            razorpay_payment_id: response.razorpay_payment_id,
            razorpay_signature: response.razorpay_signature
          })
        });

        const data = await res.json();
        console.log("VERIFY RESPONSE:", data);

        if (data.success) {
          alert("Payment verified successfully âœ…");
        } else {
          alert("Payment verification failed âŒ");
        }
      }
    };

    const rzp = new Razorpay(options);

    rzp.on("payment.failed", function (res) {
      console.error("PAYMENT FAILED:", res.error);
      alert(res.error.description);
    });

    document.getElementById("pay").onclick = () => rzp.open();
  </script>
</body>
</html>
